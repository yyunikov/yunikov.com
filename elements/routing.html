---
---
<script src="../bower_components/page/page.js"></script>
<script>
  window.addEventListener('WebComponentsReady', function() {

    // Workaround for https://github.com/visionmedia/page.js/issues/276
    function redirectLink(e) {
       page.redirect('/' + this.getAttribute('data-route'));
       e.preventDefault();
    }

    var routerLinks = document.querySelectorAll('a[href^="#!"]');
    for (var i = 0; i < routerLinks.length; i++) {
       routerLinks[i].addEventListener('click', redirectLink, false);
    }

    // Middleware
    function scrollToTop(ctx, next) {
      app.scrollPageToTop();
      next();
    }

    // Routes
    page('/', scrollToTop, function() {
      app.route = 'home';
    });

    page('/portfolio', scrollToTop, function() {
      app.route = 'portfolio';
    });

    page('/applications', scrollToTop, function() {
      app.route = 'applications';
    });

    page('/applications/:name', scrollToTop, function(data) {
      app.route = 'application-info';

      applications = {{ site.data.applications | jsonify }};
      app.app = findJsonItem(applications, data);
    });

    page('/presentations', scrollToTop, function() {
      app.route = 'presentations';
    });

    page('/presentations/:name', scrollToTop, function(data) {
      app.route = 'presentation-info';

      presentations = {{ site.data.presentations | jsonify }};
      app.pres = findJsonItem(presentations, data);
    });

    // add #! before urls
    page({
      hashbang: true
    });

    function findJsonItem(jsonItems, data) {
      for (var i = 0; i < jsonItems.length; i++) {
        if (jsonItems[i].url === data.params.name) {
          return jsonItems[i];
        }
      } 
    }
  });
</script>
